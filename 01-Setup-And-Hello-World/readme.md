# Setup and Hello World

---

- [Installing Go](#installing-go)
  - [Detailed Installaton for Linux](#detailed-installaton-for-linux)
    - [Uninstalling Go from Linux](#uninstalling-go-from-linux)
  - [Detailed Installation for Windows](#detailed-installation-for-windows)
    - [Uninstalling Go from Windows](#uninstalling-go-from-windows)
  - [Detailed Installation for Mac](#detailed-installation-for-mac)
    - [Uninstalling Go from Mac](#uninstalling-go-from-mac)
- [Go Commands](#go-commands)
- [Hello World](#hello-world)
  - [Go Module](#go-module)
  - [`main.go`](#maingo)
    - [Package Declaration](#package-declaration)
    - [Import Declaration](#import-declaration)
  - [`main` Function](#main-function)
  - [Execution](#execution)
- [`go fmt`](#go-fmt)
  - [Automatic Semicolon Insertion Rule](#automatic-semicolon-insertion-rule)
- [`go vet`](#go-vet)
- [Go Dev Tools](#go-dev-tools)
  - [VS Code Setup](#vs-code-setup)
  - [Makefiles For Build Automation](#makefiles-for-build-automation)
- [Go Compatibility Promise](#go-compatibility-promise)
- [Staying Up-To-Date](#staying-up-to-date)

---

- Every programming language needs a development environment
- We will setup a development environment for Go

## Installing Go

- We only need to install Go: No additional tools
  - [Check Here](https://go.dev/doc/install) for installation instructions
  - [Check here](https://go.dev/dl/) for all available releases
- Go programs compile to a single native binary
  - No VM needed to run
  - No additional software required to run
  - Go apps can also be [packaged inside Docker images](https://blog.baeke.info/2021/03/28/distroless-or-scratch-for-go-apps/)

### Detailed Installaton for Linux

- Download latest `.tar.gz` file from [official website](https://go.dev/dl/) into your *Downloads* directory
- Or do the following in the terminal

```sh
cd ~/Downloads
wget https://go.dev/dl/<go-version>.tar.gz
```

- Remove any previous installation if any and extract the new archive into installation location

```sh
sudo rm -rf /usr/local/go && tar -C /usr/local -xzf <go-version>.tar.gz
```

- Add `/usr/local/go/bin` to the `PATH` environment variable

```sh
export PATH=$PATH:/usr/local/go/bin
source $HOME/.bash_profile
```

- Verify the installation

```sh
go version
which go
```

#### Uninstalling Go from Linux

```sh
sudo rm -rf /usr/local/go
sudo rm /etc/paths.d/go
```

- Edit `/etc/profile` or `$HOME/.bash_profile` or `$HOME/.profile` or `$HOME/.bash_rc`

### Detailed Installation for Windows

- Download latest `.msi` file from [official website](https://go.dev/dl/) into your *Downloads* directory
- Open the `.msi` file and follow installation prompts
- Close and reopen any open command or shell prompts
- Verify the installation

```sh
go version
where go
```

#### Uninstalling Go from Windows

- Remove from the *Control Panel*
- Or remove with `msiexec`

```ps1
msiexec /x go<version>.windows-<cpu-arch>.msi /q
```

### Detailed Installation for Mac

- Download latest `.pkg` file from [official website](https://go.dev/dl/) into your *Downloads* directory
- Open the `.pkg` file and follow installation prompts
- Close and reopen any open command or shell prompts
- Verify the installation

```sh
go version
which go
```

#### Uninstalling Go from Mac

```sh
sudo rm -rf /usr/local/go
sudo rm /etc/paths.d/go
```

- Edit `/etc/profile` or `$HOME/.bash_profile` or `$HOME/.profile` or `$HOME/.bash_rc`

## Go Commands

Command | Action
:-|:-
`go version`|Check installed Go **version**
`go build`|**Compiles** a bunch of Go source code files into executable binaries
`go run`|**Compiles and executes** a bunch of Go source code files (build & execute) *but does not produce an actual executable*
`go fmt`|When ran in a directory with `.go` files, **formats** all the code in each file in the directory
`go vet`|When ran in a directory with `.go` files, **scans** for common coding mistakes
`go install`|**Compiles** and **installs** a package
`go get`|**Download** the raw source code of someone else's package
`go test`|Runs any **tests** associated with the current projects
`go mod`|For **dependency management** and **module**

## Hello World

- You are free to organize your project as you see fit
- Here is a suggested project structure

```tree
Go-Module-Name
|- go.mod
|- readme.md
|- bin/
|- src/
|  |- main.go
|- tests/
```

### Go Module

- A Go project is called a *Go Module*
  - A *Go Module* is a directory with a `go.mod` file
  - `go.mod` can be auto-generated by running the following command in the module directory

```sh
go mod init unique/module/path
```

- It declares:
  - The name of the module and its path
  - Minimum supported Go version
  - Any additional module dependencies
- **The `go.mod` file should not be edited directly**
  - Use `go` command to manage its contents
  - `go get` adds dependencies
  - `go mod tidy` verifies dependencies
- The module is then defined in `go.mod` as follows

```sh
module unique/module/path

go 1.22.1
```

### `main.go`

- In `main.go`, define the executable code

```go
package main

import "fmt"

// This is the main entry of the application.
func main() {
    fmt.Println("Hello World!")
}
```

#### Package Declaration

- Within a Go Module, codes are organized into one or more *packages*
  - **The `main` package contains the *executable* code**
  - **Any other package names are *reusable libraries***
  - **A package is essentially a directory, except for `main`**

#### Import Declaration

- Allows to import external packages that are referenced in the file
- **Go imports only whole packages**
  - We cannot limit the import to specific functions or other elements
- `fmt` is from the standard library so it is already available

### `main` Function

- **All executable Go programs starts execution from `main` function in the `main` package**

### Execution

Command | Action
:-|:-
`go build`|**Compiles** a bunch of Go source code files into executable binaries
`go run`|**Compiles and executes** a bunch of Go source code files (build + run) *but does not produce an actual executable*

- To run

```sh
go run Go-Module-Name/src/main.go
```

- To build / compile into binaries

```sh
go build -o Go-Module-Name/bin/Hello-World Go-Module-Name/src/main.go
```

- To run after compile

```sh
./Go-Module-Name/bin/Hello-World
```

- To build / compile into binaries AND run

```sh
go build -o Go-Module-Name/bin/Hello-World Go-Module-Name/src/main.go && ./Go-Module-Name/bin/Hello-World
```

- [Additional Go Commands](https://pkg.go.dev/cmd/go)
- **NOTE: By default, `go build` uses the name of the module  as the name of the binary output**
  - To specify a new name or path, we use the `-o` flag

## `go fmt`

- Go allows to write code efficiently
- Simple syntax and fast compile
- **Go also has an enforced standard formatting**
  - This simplifies the compiler
  - Makes easier collaborations
  - More productive
  - Avoid unnecessary arguments over styles and formatting
  - E.g. It is a syntax error if the opening brace is not on the same line as the declaration or block command
  - Also allows some clever tools to generate code
- `go fmt` command line can be run on all files in the project
  - Only run this from within a module directory

```sh
# Fix formatting everywhere
go fmt ./...
```

- **Remember to always run `go fmt` before compiling/building and pushing to version control**
  - This is one of the first step to ensure quality code
  - It is a good practice to make a separate commit that only does `go fmt ./...`
  - Helps to avoid combining logic changes and formatting changes
- **NOTE: In VS Code, it is possible to activate auto-formatting by `gofmt` via the Go extension settings**

### Automatic Semicolon Insertion Rule

- Go normally requires `;` at the end of every statement
- **However, Go developers should never put those `;` manually**
  - The Go compiler inserts them automatically [by following a rule](https://go.dev/doc/effective_go#semicolons)
- The short insertion rule is that: **If the newline comes after a token that could end a statement, insert a semicolon**
  - That is, *a semicolon is inserted at the newline if the last token before the newline is either:*
    - *An identifier,*
    - *A basic literal,*
    - *Or any of {`break`, `continue`, `fallthrough`, `return`, `--`, `++`, `)`, `}`}*
- **It is because of this rule that braces must be placed strategically, and why following the correct code-formatting is required**

```go
// The following breaks because...
func main() // ...a semicolon is automatically added here
{
    fmt.Println("This breaks!")
}

// However, the following works because..
func main() { // ...no automatic semicolon insertion here
    fmt.Println("This works!")
}
```

- Automatic Semicolon Insertion rule results in
  - Go compiler runs simpler and faster
  - Enforced coding-style standard

## `go vet`

- It is possible for code to be syntactically valid yet likely incorrect
- `go vet` can detect these errors
- Run in it a directory with `.go` files to scan for common coding mistakes

```go
package main

import "fmt"

// This is the main entry of the application.
func main() {
    fmt.Printf("Hello %s!\n")
}
```

- Running `go vet` on the above code will capture the error where no value was specified for the placeholder
  - The code will still compile and run
  - However, it is not correct
- **Remember to always run `go vet` before compiling/building and pushing to version control**
  - This is one of the first step to ensure quality code
- **NOTE: In VS Code, it is possible to activate *Vet On Save* by `go vet` via the Go extension settings**
- *NOTE:*
  - `fmt.Printf()` allows Print Formatting
  - `fmt.Sprintf()` allows String Interpolation

```go
package main

import "fmt"

// This is the main entry of the application.
func main() {
    fmt.Printf("Hello %s!\n", "world")
}
```

- **NOTE: `go vet` can capture many bugs, but it cannot capture all bugs**
  - We can use additional 3rd quality-code tools
  - Follow additional advices from [*Effective Go*](https://go.dev/doc/effective_go) and [*Go Wiki: Go Code Review Comments*](https://go.dev/wiki/CodeReviewComments)

## Go Dev Tools

- A simple Text Editor and Go commands can be used to write small programs
- However, better IDEs or Advanced Editors are necessary for larger projects
  - Auto-format on save (`go fmt`)
  - Auto-error-checking (`go vet`)
  - Code completion
  - Type checking
  - Code navigation
  - Integrated debugging
- There are [multiple options for Go IDEs and Advance Editors](https://go.dev/wiki/IDEsAndTextEditorPlugins)
  - [VSCode](https://code.visualstudio.com/) + [Go Extension](https://marketplace.visualstudio.com/items?itemName=golang.Go)
  - [JetBrains GoLand](https://www.jetbrains.com/go)
  - [Vim](https://www.vim.org/) and [Neovim](https://neovim.io/)
  - [GNU Emacs](https://www.gnu.org/software/emacs/)
- **Here, we will use VS Code**

### VS Code Setup

- Download [VS Code](https://code.visualstudio.com/download)
- Try to open a `.go` file with VS Code for the first time
  - The necessary Go-related extensions should automatically install
  - If not, search the `Go` extension and install
- The installation includes [all the tools listed here](https://github.com/golang/vscode-go/wiki/tools), which includes
  - A language server `gopls`
  - A debugger `dlv`
  - Unit Test `gotests`
  - Linter `staticcheck`

### Makefiles For Build Automation

- An IDE is nice to use but hard to automate
- **Automated build is essential**
  - Requiring this tooling is good software engineering practice
  - Use scripts to specify the build steps
- **Go developers use `make` as the principal build solution**
  - Has been used to build programs since 1976
  - Specify a set of operations for building the program
  - Specify the order in which to perform the steps
- To use `make`
  - Create a `makefile` in the project/module directory
  - Add the content for building the project
- **NOTE: Make sure to use *tabs* for the whitespaces for indentation**

```makefile
# NOTE: Make sure all indentations use tabs

# DEFAULT_GOAL specify the default target
# This is run when no target is specified
.DEFAULT_GOAL := build

# Target definitions
# .PHONY helps avoid possible name-collisions with other directory or file names on the computer
.PHONY: fmt vet build

# Target
fmt:
    # Task: Format all source files
    cd src
    go fmt ./...
    cd ..

# Target
vet: fmt
    # Task: Verify any possible errors
    cd src
    go vet ./...
    cd ..

# Target
build: vet
    # Task: Build in debug mode
    go build -o bin/Hello-World src/main.go

# Target
run: build
    # Task: Build in debug mode then run
    bin/Hello-World

# Target
try: vet
    # Task: Build in debug mode, run, then remove built binary
    if test -f "bin/Hello-World-Temp"; then \
        rm -f bin/Hello-World-Temp; \
    fi
    go build -o bin/Hello-World-Temp src/main.go
    bin/Hello-World-Temp
    rm -f bin/Hello-World-Temp
```

- *Target*
  - Each possible operation
  - `DEFAULT_GOAL` specify the default target when no target is specified
- *Target Definitions*
  - **The word before `:` is the name of the target**
  - **After `:` is a requirement target that must be ran before running the target**
- `.PHONY` helps avoid possible name-collisions with other directory or file names on the computer

Command|Description
:-|:-
`make`|Runs the *target* specified under `DEFAULT_GOAL`
`make <target>`|Runs the requirements and steps specific for that *target*

- **Ensuring that *formatting* and *vetting* always happen before *building* is a great improvement in the build process**
- Drawbacks of Makefiles
  - They are picky: *Must indent with tabs only*
  - Not supported out-of-the-box on Windows
    - *Must install `make` first*: `choco install make`
- [Additional resources for learning Makefiles](https://makefiletutorial.com/)

## Go Compatibility Promise

- Go is periodically updated
- New release roughly occurs every 6 months
- Patches and security fixes are as-needed
- Releases tend to be incremental than expansive
- The Go team plans to avoid breaking changes by following the [*Go Compatibility Promise*](https://go.dev/doc/go1compat)
  - **For any version with *Major 1*, there is no expected breaking changes to the language or standard library**
  - **Unless a breaking change is required for bug or security fix**
  - **But this guarantee does not apply to [Go commands](https://pkg.go.dev/cmd/go)**

## Staying Up-To-Date

- Updating Go environment does not affect previously-compiled programs
  - Go compiles to standalone native binary
  - There is no dependency on any VMs
  - The version of Go does not affect the runtime of the compiled program
- For Windows, `chocolatey` can be used to install and update Go
- For Mac, `brew` can be used to install and update Go
- Otherwise, follow the installer's option be removing and re-installing
- For Linux
  - Move the current installaton in a backup location
  - Download and unpack the new installation
  - If all is good, delete the backup
